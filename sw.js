var staticCacheName="restview-1",contentImgsCache="restview-imgs",allCaches=[staticCacheName,contentImgsCache];function servePhoto(e){var t=e.url.replace(/-\w+.(jpg|webp)$/,"");return caches.open(contentImgsCache).then(function(n){return n.match(t).then(function(s){return s||fetch(e).then(function(e){return n.put(t,e.clone()),e})})})}function synchronizewithLocalIDB(){"undefined"!=typeof idb&&"undefined"!=typeof DBHelper||self.importScripts("js/dbhelper.js","js/idb.js");const e=idb.open("Restaurants-reviews",1,function(e){e.transaction.objectStore("reviewsAdded")});return e.then(function(e){return e.transaction("reviewsAdded","readonly").objectStore("reviewsAdded").getAll()}).then(function(t){t.map(t=>{fetch("http://localhost:1337/reviews/",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)}).then(n=>{if(201===n.status)return e.then(e=>{const n=e.transaction("reviewsAdded","readwrite");return n.objectStore("reviewsAdded").delete(t.restaurant_id),console.log("review deleted from store"),n.complete})}).catch(e=>console.log("Fetch error",e))})})}self.addEventListener("install",function(e){e.waitUntil(caches.open(staticCacheName).then(function(e){return e.addAll(["./","./index.html","./restaurant.html","./css/styles.css","./css/responsive_min500.css","./css/responsive_desktop.css","./js/all.js","./js/all_restaurant.js","https://fonts.gstatic.com/s/roboto/v15/2UX7WLTfW3W8TclTUvlFyQ.woff","https://fonts.gstatic.com/s/roboto/v15/d-6IYplOFocCacKzxwXSOD8E0i7KZn-EPnyo3HZu7kw.woff"])}).catch(function(e){console.log("error with caching")}))}),self.addEventListener("activate",function(e){e.waitUntil(caches.keys().then(function(e){return Promise.all(e.filter(function(e){return e.startsWith("restview-")&&!allCaches.includes(e)}).map(function(e){return caches.delete(e)}))}))}),self.addEventListener("fetch",function(e){var t=new URL(e.request.url);if(t.origin===location.origin){if(t.pathname.startsWith("/mws-restaurant-stage-3/images/"))return void e.respondWith(servePhoto(e.request));if(t.pathname.startsWith("/mws-restaurant-stage-3/img/"))return void e.respondWith(servePhoto(e.request))}e.respondWith(caches.match(t.pathname).then(function(t){return t||fetch(e.request)}).catch(e=>console.log("Fetch error",e)))}),self.addEventListener("sync",function(e){e.waitUntil(synchronizewithLocalIDB())});